```c++
#include<iostream>
using namespace std;
#define ll long long
int n,q;
ll a[100005];

ll maxx[400005]={0};
int add[400005]={0};

ll max(ll a,ll b){
	if(a>b){
		return a;
	}
	return b;
}
void up(int i){
	maxx[i]=max(maxx[i<<1]+maxx[i<<1|1]);
}
void lazy(int i,int v){
	maxx[i]+=v;
	add[i]+=v;
}

void down(int i){
	if(add[i]!=0){
		lazy(i<<1,add[i]);
		lazy(i<<1|1,add[i]);
		add[i]=0;
	}
}
void build(int l,int r,int i){
	if(l==r){
		maxx[i]=a[l];
		return;
	}
	else{
		int m=(l+r)>>1;
		build(l,m,i<<1);
		build(m+1,r,i<<1|1);
		up(i);
	} 

}

ll query(int tl,int tr,int l,int r,int i){
	if(l>=tl&&r<=tr){
		return maxx[i];
	}
	int m=(l+r)>>1;
	down(i,m-l+1,r-m);
	ll ans=-1e18;
	if(tl<=m){
		ans=max(ans,query(tl,tr,l,m,i<<1));
	}
	if(tr>m){
		ans=max(ans,query(tl,tr,m+1,r,i<<1|1));
	}
	return ans;
}
void ad(int tl,int tr,int v,int l,int r,int i){
	if(tl<=l&&r<= tr){
		lazy(i,v);
	} else{
		int m=(l+r)>>1;
		down(i);
		if(tl<=m){
			ad(tl,tr,v,l,m,i<<1);
		}
		if(tr>m){
			ad(tl,tr,v,m+1,r,i<<1|1);
		}
		up(i);
	}
}
```

